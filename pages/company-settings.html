<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Company Settings - Vision Device Configuration Tool</title>
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
    <style>
        * {
            box-sizing: border-box;
        }
        
        *:focus-visible {
            outline: 2px solid #006dfe;
            outline-offset: 2px;
        }
        
        button:focus-visible {
            outline: 2px solid #006dfe;
            outline-offset: 2px;
        }
        
        input:focus-visible,
        select:focus-visible,
        textarea:focus-visible {
            outline: none;
            border-color: #006dfe;
            box-shadow: 
                0 0 0 3px rgba(0, 109, 254, 0.2),
                0 1px 2px rgba(0, 0, 0, 0.05);
        }
        
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            margin: 0;
            padding: 0;
            background-color: #f5f7fa;
            color: #333;
            overflow: hidden !important; /* Prevent body scrolling - all scrolling handled by .content div */
        }
        
        .page-container {
            height: 100vh;
            display: flex;
            flex-direction: column;
        }
        
        .header {
            background: white;
            border-bottom: 1px solid #e2e8f0;
            padding: 24px 32px;
            flex-shrink: 0;
            box-shadow: 0 1px 3px rgba(0,0,0,0.1);
        }
        
        .header h1 {
            margin: 0 0 16px 0;
            font-size: 30px;
            color: #1a1a1a;
            font-weight: 700;
            padding-bottom: 12px;
            border-bottom: 3px solid #006dfe;
            letter-spacing: -0.02em;
        }
        
        .header-subtitle {
            color: #64748b;
            font-size: 14px;
            margin: 0;
        }
        
        /* Tab System */
        .tabs {
            display: flex;
            gap: 0;
            border-bottom: 2px solid #e5e7eb;
            margin: 16px -32px 0;
            padding: 0 32px;
            background: linear-gradient(to bottom, white, #fafbfc);
            position: relative;
        }
        
        .tabs::after {
            content: '';
            position: absolute;
            bottom: -2px;
            left: 0;
            height: 3px;
            background: #006dfe;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            width: var(--tab-width, 0);
            transform: translateX(var(--tab-offset, 0));
        }
        
        .tab {
            background: none;
            border: none;
            border-bottom: 3px solid transparent;
            color: #64748b;
            padding: 16px 24px;
            font-size: 13px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s cubic-bezier(0.4, 0, 0.2, 1);
            position: relative;
            text-transform: uppercase;
            letter-spacing: 0.05em;
            display: flex;
            align-items: center;
            gap: 8px;
            white-space: nowrap;
        }
        
        .tab::after {
            content: '';
            position: absolute;
            bottom: -3px;
            left: 50%;
            transform: translateX(-50%) scaleX(0);
            height: 3px;
            width: 100%;
            background: #006dfe;
            transition: transform 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        }
        
        .nav-icon {
            width: 16px;
            height: 16px;
            flex-shrink: 0;
            transition: transform 0.2s ease;
        }
        
        .btn-icon {
            width: 16px;
            height: 16px;
            flex-shrink: 0;
            transition: transform 0.2s ease;
        }
        
        .btn:hover .btn-icon {
            transform: translateX(2px);
        }
        
        .tab:hover {
            color: #006dfe;
            background: linear-gradient(180deg, 
                rgba(0, 109, 254, 0) 0%, 
                rgba(0, 109, 254, 0.05) 100%);
        }
        
        .tab:hover .nav-icon {
            transform: translateY(-1px);
        }
        
        .tab.active {
            color: #006dfe;
            background: white;
        }
        
        .tab.active::after {
            transform: translateX(-50%) scaleX(1);
        }
        
        .tab.active .nav-icon {
            animation: iconBounce 0.5s ease;
        }
        
        @keyframes iconBounce {
            0%, 100% { transform: translateY(0); }
            50% { transform: translateY(-3px); }
        }
        
        /* Content Area */
        .content {
            flex: 1;
            overflow-y: auto;
            background: #f5f7fa;
        }
        
        .tab-content {
            display: none;
            padding: 32px;
        }
        
        .tab-content.active {
            display: block;
        }
        
        /* Action Bar */
        .action-bar {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 32px;
            background: white;
            padding: 24px;
            border-radius: 8px;
            border: 1px solid #e2e8f0;
            box-shadow: 0 1px 3px rgba(0,0,0,0.05);
        }
        
        .action-bar h2 {
            margin: 0;
            font-size: 20px;
            color: #1a1a1a;
            font-weight: 700;
            letter-spacing: -0.01em;
        }
        
        .action-bar p {
            margin: 8px 0 0 0;
            color: #64748b;
            font-size: 14px;
        }
        
        /* Action Buttons */
        .action-buttons {
            display: flex;
            gap: 12px;
        }
        
        /* Enhanced Button Styles */
        .btn {
            display: inline-flex;
            align-items: center;
            gap: 8px;
            padding: 12px 20px;
            border: 1px solid;
            border-radius: 6px;
            font-size: 14px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s cubic-bezier(0.4, 0, 0.2, 1);
            text-decoration: none;
            position: relative;
            overflow: hidden;
        }
        
        .btn::before {
            content: '';
            position: absolute;
            top: 50%;
            left: 50%;
            width: 0;
            height: 0;
            border-radius: 50%;
            background: rgba(255, 255, 255, 0.3);
            transform: translate(-50%, -50%);
            transition: width 0.6s, height 0.6s;
        }
        
        .btn:active::before {
            width: 300px;
            height: 300px;
        }
        
        .btn-primary {
            background: linear-gradient(135deg, #006dfe, #0056cc);
            color: white;
            border-color: transparent;
            box-shadow: 0 2px 8px rgba(0, 109, 254, 0.25);
        }
        
        .btn-primary:hover {
            background: linear-gradient(135deg, #0056cc, #004499);
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(0, 109, 254, 0.35);
        }
        
        .btn-primary:active {
            transform: translateY(0);
            box-shadow: 0 2px 4px rgba(0, 109, 254, 0.25);
        }
        
        .btn-secondary {
            background: white;
            color: #374151;
            border-color: #e5e7eb;
            box-shadow: 0 1px 3px rgba(0, 0, 0, 0.08);
        }
        
        .btn-secondary:hover {
            background: linear-gradient(135deg, #ffffff, #f9fafb);
            border-color: #d1d5db;
            transform: translateY(-1px);
            box-shadow: 0 2px 6px rgba(0, 0, 0, 0.12);
        }
        
        .btn-secondary:active {
            transform: translateY(0);
            box-shadow: 0 1px 2px rgba(0, 0, 0, 0.08);
        }
        
        .btn-danger {
            background: linear-gradient(135deg, #ef4444, #dc2626);
            color: white;
            border-color: transparent;
            box-shadow: 0 2px 8px rgba(239, 68, 68, 0.25);
        }
        
        .btn-danger:hover {
            background: linear-gradient(135deg, #dc2626, #b91c1c);
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(239, 68, 68, 0.35);
        }
        
        .btn-danger:active {
            transform: translateY(0);
            box-shadow: 0 2px 4px rgba(239, 68, 68, 0.25);
        }
        
        .btn-sm {
            padding: 8px 12px;
            font-size: 13px;
            gap: 6px;
        }
        
        .btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
            transform: none !important;
            box-shadow: none !important;
        }
        
        /* Enhanced Table Styles */
        .table-container {
            background: white;
            border-radius: 8px;
            border: 1px solid #e2e8f0;
            box-shadow: 0 1px 3px rgba(0,0,0,0.05);
            overflow: hidden;
        }
        
        .table-header {
            background: linear-gradient(135deg, #f5f7fa, #f1f5f9);
            border-bottom: 1px solid #e2e8f0;
            padding: 24px;
        }
        
        .table-title {
            font-size: 18px;
            font-weight: 700;
            color: #1a1a1a;
            margin: 0;
        }
        
        table {
            width: 100%;
            border-collapse: separate;
            border-spacing: 0;
        }
        
        th {
            background: linear-gradient(180deg, #f8fafc, #f1f5f9);
            padding: 16px 24px;
            text-align: left;
            font-weight: 700;
            color: #374151;
            font-size: 13px;
            border-bottom: 2px solid #e5e7eb;
            text-transform: uppercase;
            letter-spacing: 0.05em;
            position: sticky;
            top: 0;
            z-index: 10;
            white-space: nowrap;
        }
        
        td {
            padding: 16px 24px;
            border-bottom: 1px solid #f1f5f9;
            vertical-align: middle;
            font-size: 14px;
        }
        
        tr:last-child td {
            border-bottom: none;
        }
        
        /* Zebra striping for table rows */
        tbody tr:nth-child(even) {
            background-color: #f8f9fa;
        }
        
        tbody tr:nth-child(odd) {
            background-color: #ffffff;
        }
        
        /* MODERN HOVER EFFECT - Single left accent with enhanced background */
        
        /* Base transition for smooth hover effects */
        tbody tr {
            transition: background 0.2s ease;
        }
        
        tr:hover:not(.filter-row) {
            background: linear-gradient(90deg, 
                rgba(0, 109, 254, 0.06) 0%, 
                rgba(0, 109, 254, 0.08) 50%, 
                rgba(0, 109, 254, 0.06) 100%) !important;
        }
        
        tr:hover:not(.filter-row) td:first-child {
            position: relative;
        }
        
        tr:hover:not(.filter-row) td:first-child::after {
            content: '';
            position: absolute;
            left: 0;
            top: 0;
            bottom: 0;
            width: 3px;
            background: #006dfe;
            animation: slideIn 0.3s forwards;
        }
        
        @keyframes slideIn {
            from {
                transform: translateX(-100%);
                opacity: 0;
            }
            to {
                transform: translateX(0);
                opacity: 1;
            }
        }
        
        /* Enhanced Empty State */
        .empty-state {
            text-align: center;
            padding: 64px 32px;
            color: #64748b;
            background: linear-gradient(135deg, 
                rgba(0, 109, 254, 0.02) 0%, 
                rgba(0, 109, 254, 0) 100%);
            border-radius: 8px;
            position: relative;
        }
        
        .empty-state::before {
            content: '';
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            width: 200px;
            height: 200px;
            background: radial-gradient(circle, 
                rgba(0, 109, 254, 0.1) 0%, 
                transparent 70%);
            border-radius: 50%;
            animation: emptyPulse 3s ease-in-out infinite;
        }
        
        @keyframes emptyPulse {
            0%, 100% { 
                transform: translate(-50%, -50%) scale(1); 
                opacity: 0.5;
            }
            50% { 
                transform: translate(-50%, -50%) scale(1.1); 
                opacity: 0.8;
            }
        }
        
        .empty-state-icon {
            margin-bottom: 16px;
            position: relative;
            z-index: 1;
        }
        
        .empty-state-icon svg {
            width: 64px;
            height: 64px;
            color: #cbd5e1;
            filter: drop-shadow(0 4px 6px rgba(0, 0, 0, 0.1));
        }
        
        .empty-state h3 {
            margin: 0 0 8px 0;
            font-size: 20px;
            color: #374151;
            font-weight: 700;
            position: relative;
            z-index: 1;
        }
        
        .empty-state p {
            margin: 0 0 24px 0;
            color: #64748b;
            font-size: 14px;
            position: relative;
            z-index: 1;
        }
        
        .empty-state .btn {
            position: relative;
            z-index: 1;
        }
        
        /* Enhanced Modal Styles */
        .modal-overlay {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(15, 23, 42, 0.7);
            backdrop-filter: blur(8px);
            display: none;
            justify-content: center;
            align-items: center;
            z-index: 1000;
            animation: fadeIn 0.2s cubic-bezier(0.4, 0, 0.2, 1);
        }
        
        .modal-overlay.active {
            display: flex;
        }
        
        @keyframes fadeIn {
            from { 
                opacity: 0;
            }
            to { 
                opacity: 1;
            }
        }
        
        .modal-content {
            background: white;
            border-radius: 12px;
            width: 90%;
            max-width: 600px;
            max-height: 90vh;
            overflow: hidden;
            display: flex;
            flex-direction: column;
            box-shadow: 
                0 20px 25px -5px rgba(0, 0, 0, 0.1), 
                0 10px 10px -5px rgba(0, 0, 0, 0.04),
                0 0 0 1px rgba(0, 0, 0, 0.05);
            animation: modalSlideIn 0.3s cubic-bezier(0.34, 1.56, 0.64, 1);
        }
        
        @keyframes modalSlideIn {
            from { 
                transform: translateY(-30px) scale(0.96); 
                opacity: 0; 
            }
            to { 
                transform: translateY(0) scale(1); 
                opacity: 1; 
            }
        }
        
        .modal-header {
            padding: 24px 24px 16px;
            border-bottom: 1px solid #e5e7eb;
            background: linear-gradient(180deg, #fafbfc, #f8fafc);
        }
        
        .modal-title {
            font-size: 20px;
            font-weight: 700;
            color: #1a1a1a;
            margin: 0;
        }
        
        .modal-body {
            padding: 32px;
            overflow-y: auto;
            flex: 1;
        }
        
        .modal-footer {
            padding: 16px 24px 24px;
            border-top: 1px solid #e5e7eb;
            display: flex;
            justify-content: flex-end;
            gap: 12px;
            background: #fafbfc;
        }
        
        /* Enhanced Form Styles */
        .form-group {
            position: relative;
            margin-bottom: 24px;
        }
        
        label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
            color: #374151;
            font-size: 13px;
            text-transform: uppercase;
            letter-spacing: 0.025em;
        }
        
        .required {
            color: #ef4444;
            font-weight: 700;
        }
        
        input[type="text"],
        input[type="number"],
        select,
        textarea {
            width: 100%;
            padding: 12px 16px;
            border: 2px solid #e5e7eb;
            border-radius: 6px;
            font-size: 14px;
            transition: all 0.2s cubic-bezier(0.4, 0, 0.2, 1);
            background: white;
            outline: none;
        }
        
        input:hover:not(:focus),
        select:hover:not(:focus),
        textarea:hover:not(:focus) {
            border-color: #d1d5db;
        }
        
        input:focus,
        select:focus,
        textarea:focus {
            border-color: #006dfe;
            box-shadow: 
                0 0 0 3px rgba(0, 109, 254, 0.1),
                0 1px 2px rgba(0, 0, 0, 0.05);
            background: #fefffe;
        }
        
        input:disabled,
        select:disabled,
        textarea:disabled {
            background: #f9fafb;
            border-color: #e5e7eb;
            color: #9ca3af;
            cursor: not-allowed;
        }
        
        textarea {
            resize: vertical;
            min-height: 80px;
            font-family: inherit;
        }
        
        /* Select dropdown enhancement */
        select {
            appearance: none;
            -webkit-appearance: none;
            -moz-appearance: none;
            background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 20 20' fill='%236b7280'%3E%3Cpath fill-rule='evenodd' d='M5.293 7.293a1 1 0 011.414 0L10 10.586l3.293-3.293a1 1 0 111.414 1.414l-4 4a1 1 0 01-1.414 0l-4-4a1 1 0 010-1.414z' clip-rule='evenodd'/%3E%3C/svg%3E");
            background-repeat: no-repeat;
            background-position: right 12px center;
            background-size: 20px;
            padding-right: 40px;
        }
        
        select:focus {
            background-image: none;
        }
        
        /* Re-add arrow after dropdown closes */
        select:focus:not(:focus-within) {
            background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 20 20' fill='%23006dfe'%3E%3Cpath fill-rule='evenodd' d='M5.293 7.293a1 1 0 011.414 0L10 10.586l3.293-3.293a1 1 0 111.414 1.414l-4 4a1 1 0 01-1.414 0l-4-4a1 1 0 010-1.414z' clip-rule='evenodd'/%3E%3C/svg%3E");
        }
        
        /* Loading State */
        .loading {
            display: flex;
            justify-content: center;
            align-items: center;
            padding: 48px;
            color: #64748b;
            flex-direction: column;
            gap: 16px;
        }
        
        .spinner {
            width: 40px;
            height: 40px;
            border: 3px solid #e5e7eb;
            border-top: 3px solid #006dfe;
            border-radius: 50%;
            animation: spin 0.8s cubic-bezier(0.68, -0.55, 0.265, 1.55) infinite;
        }
        
        @keyframes spin {
            0% { 
                transform: rotate(0deg) scale(1); 
            }
            50% { 
                transform: rotate(180deg) scale(0.95); 
            }
            100% { 
                transform: rotate(360deg) scale(1); 
            }
        }
        
        .loading-text {
            font-size: 14px;
            color: #64748b;
            animation: pulse 2s ease-in-out infinite;
        }
        
        @keyframes pulse {
            0%, 100% { opacity: 0.5; }
            50% { opacity: 1; }
        }
        
        /* Status Messages */
        .status-message {
            padding: 16px 20px;
            border-radius: 6px;
            margin-bottom: 16px;
            font-size: 14px;
            font-weight: 500;
        }
        
        
        .status-info {
            background: linear-gradient(135deg, #eff6ff, #e0f2ff);
            color: #1e40af;
            border: 1px solid #dbeafe;
            box-shadow: 0 1px 3px rgba(30, 64, 175, 0.1);
            display: flex;
            align-items: center;
            gap: 8px;
        }
        
        .status-success {
            background: linear-gradient(135deg, #dcfce7, #d1fae5);
            color: #166534;
            border: 1px solid #bbf7d0;
            box-shadow: 0 1px 3px rgba(22, 101, 52, 0.1);
            display: flex;
            align-items: center;
            gap: 8px;
        }
        
        .status-error {
            background: linear-gradient(135deg, #fef2f2, #fee2e2);
            color: #991b1b;
            border: 1px solid #fecaca;
            box-shadow: 0 1px 3px rgba(153, 27, 27, 0.1);
            display: flex;
            align-items: center;
            gap: 8px;
        }
        
        .status-icon {
            width: 16px;
            height: 16px;
            flex-shrink: 0;
            animation: statusPulse 2s ease-in-out infinite;
        }
        
        @keyframes statusPulse {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.05); }
        }
        
        .table-icon {
            width: 16px;
            height: 16px;
            margin-right: 4px;
            vertical-align: middle;
            transition: transform 0.2s ease;
        }
        
        tr:hover .table-icon {
            transform: scale(1.1);
        }
        
        /* Filter Row */
        .filter-row td {
            padding: 16px 24px;
            background: #f5f7fa;
            border-bottom: 2px solid #e2e8f0;
        }
        
        .filter-input {
            width: 100%;
            padding: 8px 12px;
            border: 1px solid #d1d5db;
            border-radius: 6px;
            font-size: 13px;
        }
        
        .filter-input:focus {
            outline: none;
            border-color: #006dfe;
            box-shadow: 0 0 0 2px rgba(0, 109, 254, 0.1);
        }
        
        /* Image Preview */
        .image-preview {
            width: 48px;
            height: 48px;
            object-fit: cover;
            border-radius: 6px;
            border: 2px solid #e5e7eb;
            transition: transform 0.2s ease;
        }
        
        .image-preview:hover {
            transform: scale(1.05);
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.15);
        }
        
        .image-placeholder {
            width: 48px;
            height: 48px;
            background: #f5f7fa;
            border: 2px solid #e5e7eb;
            border-radius: 6px;
            display: flex;
            align-items: center;
            justify-content: center;
            color: #9ca3af;
            font-size: 13px;
            font-weight: 500;
        }
        
        /* Geocoding specific styles */
        .geocode-section {
            background: linear-gradient(135deg, #f8fafc, #f5f7fa);
            border: 1px solid #e5e7eb;
            border-radius: 8px;
            padding: 24px;
            margin-top: 16px;
            position: relative;
            overflow: hidden;
        }
        
        .geocode-section::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 3px;
            background: linear-gradient(90deg, #006dfe, #0056cc);
            opacity: 0.8;
        }
        
        .geocode-section h4 {
            margin: 0 0 16px 0;
            color: #374151;
            font-size: 14px;
            font-weight: 700;
            display: flex;
            align-items: center;
            gap: 8px;
            position: relative;
        }
        
        .section-icon {
            width: 16px;
            height: 16px;
            flex-shrink: 0;
            color: #006dfe;
            animation: iconPulse 2s ease-in-out infinite;
        }
        
        @keyframes iconPulse {
            0%, 100% { opacity: 0.7; }
            50% { opacity: 1; }
        }
        
        .geocode-button {
            margin-bottom: 16px;
        }
        
        .coordinate-inputs {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 16px;
        }
        
        .coordinate-inputs input {
            background: linear-gradient(180deg, #f9fafb, #f1f5f9);
            cursor: not-allowed;
            border-color: #d1d5db;
        }
        
        #mapPreview {
            height: 200px;
            border-radius: 8px;
            margin-top: 16px;
            border: 2px solid #e5e7eb;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.08);
        }
        
        /* Responsive Design */
        @media (max-width: 768px) {
            .header {
                padding: 16px;
            }
            
            .tabs {
                margin: 16px -16px 0;
                padding: 0 16px;
            }
            
            .tab-content {
                padding: 16px;
            }
            
            .action-bar {
                flex-direction: column;
                align-items: stretch;
                gap: 16px;
            }
            
            .action-buttons {
                justify-content: stretch;
            }
            
            .btn {
                flex: 1;
                justify-content: center;
            }
            
            .modal-content {
                width: 95%;
                margin: 16px;
            }
            
            .modal-body,
            .modal-header,
            .modal-footer {
                padding: 24px;
            }
            
            .coordinate-inputs {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body>
    <div class="page-container">
        <div class="header">
            <h1>Company Settings</h1>
            <p class="header-subtitle">Manage your company's locations, routes, and products</p>
            <div class="tabs" role="tablist" aria-label="Settings sections">
                <button class="tab active" data-tab="locations" role="tab" aria-selected="true" aria-controls="locations-panel" id="locations-tab">
                    <svg class="nav-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" aria-hidden="true">
                        <path d="M21 10c0 7-9 13-9 13s-9-6-9-13a9 9 0 0 1 18 0z"></path>
                        <circle cx="12" cy="10" r="3"></circle>
                    </svg>
                    Locations
                </button>
                <button class="tab" data-tab="routes" role="tab" aria-selected="false" aria-controls="routes-panel" id="routes-tab">
                    <svg class="nav-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" aria-hidden="true">
                        <path d="M1 3h15v13H1z"></path>
                        <path d="m16 8 4-4-4-4"></path>
                        <circle cx="5.5" cy="18.5" r="2.5"></circle>
                        <circle cx="18.5" cy="18.5" r="2.5"></circle>
                    </svg>
                    Routes
                </button>
                <button class="tab" data-tab="products" role="tab" aria-selected="false" aria-controls="products-panel" id="products-tab">
                    <svg class="nav-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" aria-hidden="true">
                        <path d="M21 8a2 2 0 0 0-1-1.73l-7-4a2 2 0 0 0-2 0l-7 4A2 2 0 0 0 3 8v8a2 2 0 0 0 1 1.73l7 4a2 2 0 0 0 2 0l7-4A2 2 0 0 0 21 16V8z"></path>
                        <polyline points="3.29,7 12,12 20.71,7"></polyline>
                        <line x1="12" y1="22" x2="12" y2="12"></line>
                    </svg>
                    Products
                </button>
            </div>
        </div>
        
        <div class="content">
            <!-- Locations Tab -->
            <div id="locations" class="tab-content active" role="tabpanel" aria-labelledby="locations-tab" id="locations-panel">
                <div class="action-bar">
                    <div>
                        <h2>Locations</h2>
                        <p>Manage your vending machine locations with geocoding support</p>
                    </div>
                    <button class="btn btn-primary" onclick="openModal('location')" aria-label="Create new location">
                        <svg class="btn-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" aria-hidden="true">
                            <line x1="12" y1="5" x2="12" y2="19"></line>
                            <line x1="5" y1="12" x2="19" y2="12"></line>
                        </svg>
                        Create New Location
                    </button>
                </div>
                <div class="table-container">
                    <div id="locationsLoading" class="loading" role="status" aria-live="polite">
                        <div class="spinner" aria-hidden="true"></div>
                        <span class="loading-text">Loading locations...</span>
                        <span class="sr-only">Please wait while locations are being loaded</span>
                    </div>
                    <table id="locationsTable" style="display: none;" role="table" aria-label="Locations list">
                        <thead>
                            <tr>
                                <th style="width: 20%;">Name</th>
                                <th style="width: 35%;">Address</th>
                                <th style="width: 10%;">Latitude</th>
                                <th style="width: 10%;">Longitude</th>
                                <th style="width: 12%;">Created Date</th>
                                <th style="width: 13%;">Actions</th>
                            </tr>
                        </thead>
                        <tbody id="locationsTableBody">
                        </tbody>
                    </table>
                    <div id="locationsEmpty" class="empty-state" style="display: none;">
                        <div class="empty-state-icon">
                            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" aria-hidden="true">
                                <path d="M21 10c0 7-9 13-9 13s-9-6-9-13a9 9 0 0 1 18 0z"></path>
                                <circle cx="12" cy="10" r="3"></circle>
                            </svg>
                        </div>
                        <h3>No locations found</h3>
                        <p>Start by adding your first vending machine location</p>
                        <button class="btn btn-primary" onclick="openModal('location')">Create Your First Location</button>
                    </div>
                </div>
            </div>
            
            <!-- Routes Tab -->
            <div id="routes" class="tab-content" role="tabpanel" aria-labelledby="routes-tab" id="routes-panel" hidden>
                <div class="action-bar">
                    <div>
                        <h2>Routes</h2>
                        <p>Organize locations into delivery routes with driver assignments</p>
                    </div>
                    <button class="btn btn-primary" onclick="openModal('route')">
                        <svg class="btn-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" aria-hidden="true">
                            <line x1="12" y1="5" x2="12" y2="19"></line>
                            <line x1="5" y1="12" x2="19" y2="12"></line>
                        </svg>
                        Create New Route
                    </button>
                </div>
                <div class="table-container">
                    <div id="routesLoading" class="loading">
                        <div class="spinner"></div>
                        Loading routes...
                    </div>
                    <table id="routesTable" style="display: none;">
                        <thead>
                            <tr>
                                <th style="width: 30%;">Name</th>
                                <th style="width: 15%;">Route Number</th>
                                <th style="width: 25%;">Assigned Driver</th>
                                <th style="width: 15%;">Created Date</th>
                                <th style="width: 15%;">Actions</th>
                            </tr>
                        </thead>
                        <tbody id="routesTableBody">
                        </tbody>
                    </table>
                    <div id="routesEmpty" class="empty-state" style="display: none;">
                        <div class="empty-state-icon">
                            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" aria-hidden="true">
                                <path d="M1 3h15v13H1z"></path>
                                <path d="m16 8 4-4-4-4"></path>
                                <circle cx="5.5" cy="18.5" r="2.5"></circle>
                                <circle cx="18.5" cy="18.5" r="2.5"></circle>
                            </svg>
                        </div>
                        <h3>No routes found</h3>
                        <p>Create routes to organize your service locations efficiently</p>
                        <button class="btn btn-primary" onclick="openModal('route')">Create Your First Route</button>
                    </div>
                </div>
            </div>
            
            <!-- Products Tab -->
            <div id="products" class="tab-content" role="tabpanel" aria-labelledby="products-tab" id="products-panel" hidden>
                <div class="action-bar">
                    <div>
                        <h2>Products</h2>
                        <p>Manage your product catalog with pricing and categorization</p>
                    </div>
                    <button class="btn btn-primary" onclick="openModal('product')">
                        <svg class="btn-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" aria-hidden="true">
                            <line x1="12" y1="5" x2="12" y2="19"></line>
                            <line x1="5" y1="12" x2="19" y2="12"></line>
                        </svg>
                        Create New Product
                    </button>
                </div>
                <div class="table-container">
                    <div id="productsLoading" class="loading">
                        <div class="spinner"></div>
                        Loading products...
                    </div>
                    <table id="productsTable" style="display: none;">
                        <thead>
                            <tr>
                                <th style="width: 10%;">Image</th>
                                <th style="width: 30%;">Name</th>
                                <th style="width: 20%;">Category</th>
                                <th style="width: 12%;">Price</th>
                                <th style="width: 15%;">Created Date</th>
                                <th style="width: 13%;">Actions</th>
                            </tr>
                        </thead>
                        <tbody id="productsTableBody">
                        </tbody>
                    </table>
                    <div id="productsEmpty" class="empty-state" style="display: none;">
                        <div class="empty-state-icon">
                            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" aria-hidden="true">
                                <path d="M21 8a2 2 0 0 0-1-1.73l-7-4a2 2 0 0 0-2 0l-7 4A2 2 0 0 0 3 8v8a2 2 0 0 0 1 1.73l7 4a2 2 0 0 0 2 0l7-4A2 2 0 0 0 21 16V8z"></path>
                                <polyline points="3.29,7 12,12 20.71,7"></polyline>
                                <line x1="12" y1="22" x2="12" y2="12"></line>
                            </svg>
                        </div>
                        <h3>No products found</h3>
                        <p>Add products to build your vending machine catalog</p>
                        <button class="btn btn-primary" onclick="openModal('product')">Add Your First Product</button>
                    </div>
                </div>
            </div>
        </div>
    </div>
    
    <!-- Location Modal -->
    <div id="locationModal" class="modal-overlay">
        <div class="modal-content">
            <div class="modal-header">
                <h3 class="modal-title" id="locationModalTitle">Create New Location</h3>
            </div>
            <div class="modal-body">
                <form id="locationForm">
                    <input type="hidden" id="locationId" name="id">
                    <div class="form-group">
                        <label for="locationName">Location Name <span class="required">*</span></label>
                        <input type="text" id="locationName" name="name" required placeholder="Enter location name">
                    </div>
                    <div class="form-group">
                        <label for="locationAddress">Address <span class="required">*</span></label>
                        <textarea id="locationAddress" name="address" required placeholder="Enter full address including city, state, and zip code"></textarea>
                    </div>
                    
                    <div class="geocode-section">
                        <h4>
                            <svg class="section-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" aria-hidden="true">
                                <path d="M21 10c0 7-9 13-9 13s-9-6-9-13a9 9 0 0 1 18 0z"></path>
                                <circle cx="12" cy="10" r="3"></circle>
                            </svg>
                            Geocoding
                        </h4>
                        <button type="button" class="btn btn-secondary geocode-button" onclick="geocodeAddress()">
                            <svg class="btn-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" aria-hidden="true">
                                <circle cx="11" cy="11" r="8"></circle>
                                <path d="m21 21-4.35-4.35"></path>
                            </svg>
                            Geocode Address
                        </button>
                        <div id="geocodeStatus" style="display: none;"></div>
                        
                        <div class="coordinate-inputs">
                            <div class="form-group">
                                <label for="locationLatitude">Latitude</label>
                                <input type="text" id="locationLatitude" name="latitude" readonly placeholder="Auto-filled from geocoding">
                            </div>
                            <div class="form-group">
                                <label for="locationLongitude">Longitude</label>
                                <input type="text" id="locationLongitude" name="longitude" readonly placeholder="Auto-filled from geocoding">
                            </div>
                        </div>
                        
                        <div id="mapPreview" style="display: none;"></div>
                    </div>
                </form>
            </div>
            <div class="modal-footer">
                <button class="btn btn-secondary" onclick="closeModal('location')">Cancel</button>
                <button class="btn btn-primary" id="locationSaveBtn" onclick="saveLocation()">Save Location</button>
            </div>
        </div>
    </div>
    
    <!-- Route Modal -->
    <div id="routeModal" class="modal-overlay">
        <div class="modal-content">
            <div class="modal-header">
                <h3 class="modal-title" id="routeModalTitle">Create New Route</h3>
            </div>
            <div class="modal-body">
                <form id="routeForm">
                    <input type="hidden" id="routeId" name="id">
                    <div class="form-group">
                        <label for="routeName">Route Name <span class="required">*</span></label>
                        <input type="text" id="routeName" name="name" required placeholder="Enter route name">
                    </div>
                    <div class="form-group">
                        <label for="routeNumber">Route Number</label>
                        <input type="number" id="routeNumber" name="routeNumber" placeholder="Optional route number">
                    </div>
                    <div class="form-group">
                        <label for="routeDriver">Assigned Driver</label>
                        <select id="routeDriver" name="driverId">
                            <option value="">No driver assigned</option>
                        </select>
                    </div>
                </form>
            </div>
            <div class="modal-footer">
                <button class="btn btn-secondary" onclick="closeModal('route')">Cancel</button>
                <button class="btn btn-primary" id="routeSaveBtn" onclick="saveRoute()">Save Route</button>
            </div>
        </div>
    </div>
    
    <!-- Product Modal -->
    <div id="productModal" class="modal-overlay" role="dialog" aria-modal="true" aria-labelledby="productModalTitle" aria-hidden="true">
        <div class="modal-content">
            <div class="modal-header">
                <h3 class="modal-title" id="productModalTitle">Create New Product</h3>
            </div>
            <div class="modal-body">
                <form id="productForm">
                    <input type="hidden" id="productId" name="id">
                    <div class="form-group">
                        <label for="productName">Product Name <span class="required" aria-label="required">*</span></label>
                        <input type="text" id="productName" name="name" required aria-required="true" placeholder="Enter product name">
                    </div>
                    <div class="form-group">
                        <label for="productCategory">Category <span class="required" aria-label="required">*</span></label>
                        <select id="productCategory" name="category" required aria-required="true">
                            <option value="">Select Category</option>
                            <option value="water">Water</option>
                            <option value="soda">Soda</option>
                            <option value="juice">Juice</option>
                            <option value="sports">Sports Drinks</option>
                            <option value="energy">Energy Drinks</option>
                            <option value="snacks">Snacks</option>
                            <option value="candy">Candy</option>
                            <option value="other">Other</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="productPrice">Price <span class="required" aria-label="required">*</span></label>
                        <input type="number" id="productPrice" name="price" step="0.01" min="0" required aria-required="true" placeholder="0.00">
                    </div>
                    <div class="form-group">
                        <label for="productImage">Image URL</label>
                        <input type="text" id="productImage" name="image" placeholder="https://example.com/image.jpg">
                    </div>
                </form>
            </div>
            <div class="modal-footer">
                <button class="btn btn-secondary" onclick="closeModal('product')">Cancel</button>
                <button class="btn btn-primary" id="productSaveBtn" onclick="saveProduct()">Save Product</button>
            </div>
        </div>
    </div>
    
    <!-- Confirmation Modal -->
    <div id="confirmModal" class="modal-overlay" role="alertdialog" aria-modal="true" aria-labelledby="confirmTitle" aria-describedby="confirmMessage" aria-hidden="true">
        <div class="modal-content" style="max-width: 400px;">
            <div class="modal-header">
                <h3 class="modal-title" id="confirmTitle">Confirm Delete</h3>
            </div>
            <div class="modal-body">
                <p id="confirmMessage">Are you sure you want to delete this item?</p>
            </div>
            <div class="modal-footer">
                <button class="btn btn-secondary" onclick="closeConfirmModal()">Cancel</button>
                <button class="btn btn-danger" id="confirmDeleteBtn">Delete</button>
            </div>
        </div>
    </div>
    
    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
    <script src="/api.js"></script>
    <script src="/auth-check.js"></script>
    <script>
        // Initialize API client
        const api = new CVDApi();
        
        // Map instance for location preview
        let locationMap = null;
        let locationMarker = null;
        
        // State management
        const state = {
            currentTab: 'locations',
            locations: [],
            routes: [],
            products: [],
            drivers: [],
            editingId: null,
            deleteCallback: null,
            activeFilters: {},
            sortConfigs: {
                locations: { column: 'name', direction: 'asc' },
                routes: { column: 'name', direction: 'asc' },
                products: { column: 'name', direction: 'asc' }
            }
        };
        
        // Focus management
        class FocusManager {
            constructor() {
                this.previousFocus = null;
            }
            
            saveFocus() {
                this.previousFocus = document.activeElement;
            }
            
            restoreFocus() {
                if (this.previousFocus) {
                    this.previousFocus.focus();
                    this.previousFocus = null;
                }
            }
            
            focusFirst(container) {
                const focusable = container.querySelector(
                    'button, input, select, textarea, a[href]'
                );
                if (focusable) focusable.focus();
            }
            
            trapFocus(modal) {
                const focusableElements = modal.querySelectorAll(
                    'button:not([disabled]), input:not([disabled]), select:not([disabled]), textarea:not([disabled]), a[href]'
                );
                const firstFocusable = focusableElements[0];
                const lastFocusable = focusableElements[focusableElements.length - 1];
                
                if (!firstFocusable) return;
                
                modal.addEventListener('keydown', (e) => {
                    if (e.key === 'Tab') {
                        if (e.shiftKey && document.activeElement === firstFocusable) {
                            e.preventDefault();
                            lastFocusable.focus();
                        } else if (!e.shiftKey && document.activeElement === lastFocusable) {
                            e.preventDefault();
                            firstFocusable.focus();
                        }
                    }
                });
            }
        }
        
        const focusManager = new FocusManager();
        
        // Performance utilities
        function debounce(func, wait) {
            let timeout;
            return function executedFunction(...args) {
                const later = () => {
                    clearTimeout(timeout);
                    func(...args);
                };
                clearTimeout(timeout);
                timeout = setTimeout(later, wait);
            };
        }
        
        // Accessibility enhancements
        function enhanceAccessibility() {
            // Add ARIA labels to all buttons without labels
            document.querySelectorAll('.btn').forEach(btn => {
                if (!btn.getAttribute('aria-label') && !btn.querySelector('text')) {
                    const text = btn.textContent.trim();
                    if (text) btn.setAttribute('aria-label', text);
                }
            });
            
            // Add role attributes to tables
            document.querySelectorAll('table').forEach(table => {
                if (!table.getAttribute('role')) {
                    table.setAttribute('role', 'table');
                }
                const headers = table.querySelectorAll('th');
                headers.forEach((th, index) => {
                    th.setAttribute('scope', 'col');
                    if (!th.id) th.id = `col-${state.currentTab}-${index}`;
                });
            });
            
            // Add live regions for status messages
            const statusContainers = document.querySelectorAll('[class*="status-"]');
            statusContainers.forEach(container => {
                if (!container.getAttribute('role')) {
                    container.setAttribute('role', 'status');
                    container.setAttribute('aria-live', 'polite');
                }
            });
        }
        
        // Initialize on page load
        document.addEventListener('DOMContentLoaded', function() {
            setupTabHandlers();
            setupFilterHandlers();
            setupKeyboardNavigation();
            enhanceAccessibility();
            loadTabData('locations');
        });
        
        // Tab switching with keyboard support
        function setupTabHandlers() {
            const tabs = document.querySelectorAll('.tab');
            
            tabs.forEach((tab, index) => {
                // Set initial ARIA attributes
                tab.setAttribute('tabindex', tab.classList.contains('active') ? '0' : '-1');
                
                tab.addEventListener('click', function() {
                    switchTab(this);
                });
                
                // Keyboard navigation
                tab.addEventListener('keydown', (e) => {
                    let targetTab = null;
                    
                    switch(e.key) {
                        case 'ArrowLeft':
                            targetTab = tabs[index - 1] || tabs[tabs.length - 1];
                            break;
                        case 'ArrowRight':
                            targetTab = tabs[index + 1] || tabs[0];
                            break;
                        case 'Home':
                            targetTab = tabs[0];
                            break;
                        case 'End':
                            targetTab = tabs[tabs.length - 1];
                            break;
                    }
                    
                    if (targetTab) {
                        e.preventDefault();
                        switchTab(targetTab);
                        targetTab.focus();
                    }
                });
            });
        }
        
        function switchTab(tab) {
            // Update ARIA attributes
            document.querySelectorAll('.tab').forEach(t => {
                t.classList.remove('active');
                t.setAttribute('aria-selected', 'false');
                t.setAttribute('tabindex', '-1');
            });
            document.querySelectorAll('.tab-content').forEach(c => {
                c.classList.remove('active');
                c.setAttribute('hidden', 'true');
            });
            
            tab.classList.add('active');
            tab.setAttribute('aria-selected', 'true');
            tab.setAttribute('tabindex', '0');
            
            const tabName = tab.dataset.tab;
            const panel = document.getElementById(tabName);
            panel.classList.add('active');
            panel.removeAttribute('hidden');
            
            state.currentTab = tabName;
            loadTabData(tabName);
            
            // Update page title
            document.title = `Company Settings - ${tabName.charAt(0).toUpperCase() + tabName.slice(1)} - Vision Device Configuration Tool`;
        }
        
        // Setup keyboard navigation
        function setupKeyboardNavigation() {
            // Global keyboard shortcuts
            document.addEventListener('keydown', (e) => {
                // Escape key closes modals
                if (e.key === 'Escape') {
                    const activeModal = document.querySelector('.modal-overlay.active');
                    if (activeModal) {
                        const modalType = activeModal.id.replace('Modal', '');
                        closeModal(modalType);
                    }
                }
            });
        }
        
        // Load data for current tab
        async function loadTabData(tabName) {
            switch(tabName) {
                case 'locations':
                    await loadLocations();
                    break;
                case 'routes':
                    await loadRoutes();
                    break;
                case 'products':
                    await loadProducts();
                    break;
            }
        }
        
        // Load locations
        async function loadLocations() {
            const loading = document.getElementById('locationsLoading');
            const table = document.getElementById('locationsTable');
            const empty = document.getElementById('locationsEmpty');
            const tbody = document.getElementById('locationsTableBody');
            
            loading.style.display = 'flex';
            table.style.display = 'none';
            empty.style.display = 'none';
            
            try {
                const locations = await api.getLocations();
                state.locations = locations;
                
                loading.style.display = 'none';
                
                if (locations.length === 0) {
                    empty.style.display = 'block';
                } else {
                    table.style.display = 'table';
                    renderLocationsTable(locations);
                }
            } catch (error) {
                loading.style.display = 'none';
                showError('Failed to load locations: ' + error.message);
            }
        }
        
        // Load routes
        async function loadRoutes() {
            const loading = document.getElementById('routesLoading');
            const table = document.getElementById('routesTable');
            const empty = document.getElementById('routesEmpty');
            const tbody = document.getElementById('routesTableBody');
            
            loading.style.display = 'flex';
            table.style.display = 'none';
            empty.style.display = 'none';
            
            try {
                const routes = await api.getRoutes();
                state.routes = routes;
                
                loading.style.display = 'none';
                
                if (routes.length === 0) {
                    empty.style.display = 'block';
                } else {
                    table.style.display = 'table';
                    renderRoutesTable(routes);
                }
            } catch (error) {
                loading.style.display = 'none';
                showError('Failed to load routes: ' + error.message);
            }
        }
        
        // Load products
        async function loadProducts() {
            const loading = document.getElementById('productsLoading');
            const table = document.getElementById('productsTable');
            const empty = document.getElementById('productsEmpty');
            const tbody = document.getElementById('productsTableBody');
            
            loading.style.display = 'flex';
            table.style.display = 'none';
            empty.style.display = 'none';
            
            try {
                const products = await api.getProducts();
                state.products = products;
                
                loading.style.display = 'none';
                
                if (products.length === 0) {
                    empty.style.display = 'block';
                } else {
                    table.style.display = 'table';
                    renderProductsTable(products);
                }
            } catch (error) {
                loading.style.display = 'none';
                showError('Failed to load products: ' + error.message);
            }
        }
        
        // Load drivers
        async function loadDrivers() {
            try {
                const drivers = await api.getDrivers();
                state.drivers = drivers;
                
                // Update driver dropdown
                const driverSelect = document.getElementById('routeDriver');
                const currentValue = driverSelect.value;
                
                driverSelect.innerHTML = '<option value="">No driver assigned</option>';
                drivers.forEach(driver => {
                    const option = document.createElement('option');
                    option.value = driver.id;
                    option.textContent = `${driver.username} (${driver.email})`;
                    driverSelect.appendChild(option);
                });
                
                // Restore previous value if it exists
                if (currentValue) {
                    driverSelect.value = currentValue;
                }
            } catch (error) {
                showError('Failed to load drivers: ' + error.message);
            }
        }
        
        // Modal functions with accessibility
        async function openModal(type) {
            const modal = document.getElementById(`${type}Modal`);
            
            // Save current focus
            focusManager.saveFocus();
            
            // Show modal
            modal.classList.add('active');
            modal.setAttribute('aria-hidden', 'false');
            
            // Reset form and set to create mode
            const form = document.getElementById(`${type}Form`);
            form.reset();
            state.editingId = null;
            
            // Update modal title and button text
            document.getElementById(`${type}ModalTitle`).textContent = `Create New ${type.charAt(0).toUpperCase() + type.slice(1)}`;
            document.getElementById(`${type}SaveBtn`).textContent = `Save ${type.charAt(0).toUpperCase() + type.slice(1)}`;
            
            // Load drivers if opening route modal
            if (type === 'route') {
                await loadDrivers();
            }
            
            // Reset location modal specific elements
            if (type === 'location') {
                document.getElementById('geocodeStatus').style.display = 'none';
                document.getElementById('mapPreview').style.display = 'none';
                if (locationMap) {
                    locationMap.remove();
                    locationMap = null;
                    locationMarker = null;
                }
            }
            
            // Set up focus trap and focus first element
            focusManager.trapFocus(modal);
            setTimeout(() => {
                focusManager.focusFirst(form);
            }, 100);
            
            // Announce to screen readers
            const announcement = document.createElement('div');
            announcement.className = 'sr-only';
            announcement.setAttribute('role', 'status');
            announcement.setAttribute('aria-live', 'polite');
            announcement.textContent = `${type.charAt(0).toUpperCase() + type.slice(1)} creation dialog opened`;
            document.body.appendChild(announcement);
            setTimeout(() => announcement.remove(), 1000);
        }
        
        function closeModal(type) {
            const modal = document.getElementById(`${type}Modal`);
            modal.classList.remove('active');
            modal.setAttribute('aria-hidden', 'true');
            state.editingId = null;
            
            // Clean up location map
            if (type === 'location' && locationMap) {
                locationMap.remove();
                locationMap = null;
                locationMarker = null;
            }
            
            // Restore focus
            focusManager.restoreFocus();
            
            // Announce to screen readers
            const announcement = document.createElement('div');
            announcement.className = 'sr-only';
            announcement.setAttribute('role', 'status');
            announcement.setAttribute('aria-live', 'polite');
            announcement.textContent = `${type.charAt(0).toUpperCase() + type.slice(1)} dialog closed`;
            document.body.appendChild(announcement);
            setTimeout(() => announcement.remove(), 1000);
        }
        
        // Edit functions
        function editLocation(location) {
            state.editingId = location.id;
            document.getElementById('locationId').value = location.id;
            document.getElementById('locationName').value = location.name;
            document.getElementById('locationAddress').value = location.address || '';
            document.getElementById('locationLatitude').value = location.latitude || '';
            document.getElementById('locationLongitude').value = location.longitude || '';
            document.getElementById('locationModalTitle').textContent = 'Edit Location';
            document.getElementById('locationSaveBtn').textContent = 'Update Location';
            document.getElementById('locationModal').classList.add('active');
            
            // Reset geocode status
            document.getElementById('geocodeStatus').style.display = 'none';
            
            // Show map if coordinates exist
            if (location.latitude && location.longitude) {
                showMapPreview(location.latitude, location.longitude);
            } else {
                document.getElementById('mapPreview').style.display = 'none';
            }
        }
        
        async function editRoute(id, name, routeNumber, driverId) {
            state.editingId = id;
            await loadDrivers();
            document.getElementById('routeId').value = id;
            document.getElementById('routeName').value = name;
            document.getElementById('routeNumber').value = routeNumber || '';
            document.getElementById('routeDriver').value = driverId || '';
            document.getElementById('routeModalTitle').textContent = 'Edit Route';
            document.getElementById('routeSaveBtn').textContent = 'Update Route';
            document.getElementById('routeModal').classList.add('active');
        }
        
        function editProduct(id, name, category, price, image) {
            state.editingId = id;
            document.getElementById('productId').value = id;
            document.getElementById('productName').value = name;
            document.getElementById('productCategory').value = category;
            document.getElementById('productPrice').value = price;
            document.getElementById('productImage').value = image || '';
            document.getElementById('productModalTitle').textContent = 'Edit Product';
            document.getElementById('productSaveBtn').textContent = 'Update Product';
            document.getElementById('productModal').classList.add('active');
        }
        
        // Delete functions
        function deleteLocation(id, name) {
            showConfirmDialog(
                'Delete Location',
                `Are you sure you want to delete "${name}"?`,
                async () => {
                    try {
                        await api.deleteLocation(id);
                        showSuccess('Location deleted successfully');
                        loadLocations();
                    } catch (error) {
                        showError('Failed to delete location: ' + error.message);
                    }
                }
            );
        }
        
        function deleteRoute(id, name) {
            showConfirmDialog(
                'Delete Route',
                `Are you sure you want to delete "${name}"?`,
                async () => {
                    try {
                        await api.deleteRoute(id);
                        showSuccess('Route deleted successfully');
                        loadRoutes();
                    } catch (error) {
                        showError('Failed to delete route: ' + error.message);
                    }
                }
            );
        }
        
        function deleteProduct(id, name) {
            showConfirmDialog(
                'Delete Product',
                `Are you sure you want to delete "${name}"?`,
                async () => {
                    try {
                        await api.deleteProduct(id);
                        showSuccess('Product deleted successfully');
                        loadProducts();
                    } catch (error) {
                        showError('Failed to delete product: ' + error.message);
                    }
                }
            );
        }
        
        // Confirmation dialog
        function showConfirmDialog(title, message, callback) {
            const modal = document.getElementById('confirmModal');
            
            // Save current focus
            focusManager.saveFocus();
            
            document.getElementById('confirmTitle').textContent = title;
            document.getElementById('confirmMessage').textContent = message;
            state.deleteCallback = callback;
            
            modal.classList.add('active');
            modal.setAttribute('aria-hidden', 'false');
            
            // Set up delete button handler
            document.getElementById('confirmDeleteBtn').onclick = async () => {
                closeConfirmModal();
                if (state.deleteCallback) {
                    await state.deleteCallback();
                }
            };
            
            // Focus the cancel button (safer default)
            setTimeout(() => {
                document.querySelector('#confirmModal .btn-secondary').focus();
            }, 100);
            
            // Set up focus trap
            focusManager.trapFocus(modal);
        }
        
        function closeConfirmModal() {
            const modal = document.getElementById('confirmModal');
            modal.classList.remove('active');
            modal.setAttribute('aria-hidden', 'true');
            state.deleteCallback = null;
            
            // Restore focus
            focusManager.restoreFocus();
        }
        
        // Save functions
        async function saveLocation() {
            const nameInput = document.getElementById('locationName');
            const addressInput = document.getElementById('locationAddress');
            const latitudeInput = document.getElementById('locationLatitude');
            const longitudeInput = document.getElementById('locationLongitude');
            
            const name = nameInput.value.trim();
            const address = addressInput.value.trim();
            const latitude = latitudeInput.value ? parseFloat(latitudeInput.value) : null;
            const longitude = longitudeInput.value ? parseFloat(longitudeInput.value) : null;
            
            if (!name) {
                showError('Please enter a location name');
                return;
            }
            
            if (!address) {
                showError('Please enter an address');
                return;
            }
            
            const locationData = { name, address, latitude, longitude };
            
            try {
                if (state.editingId) {
                    await api.updateLocation(state.editingId, locationData);
                    showSuccess('Location updated successfully');
                } else {
                    await api.createLocation(locationData);
                    showSuccess('Location created successfully');
                }
                closeModal('location');
                loadLocations();
            } catch (error) {
                showError('Failed to save location: ' + error.message);
            }
        }
        
        async function saveRoute() {
            const nameInput = document.getElementById('routeName');
            const numberInput = document.getElementById('routeNumber');
            const driverInput = document.getElementById('routeDriver');
            
            const name = nameInput.value.trim();
            const routeNumber = numberInput.value ? parseInt(numberInput.value) : null;
            const driverId = driverInput.value ? parseInt(driverInput.value) : null;
            
            if (!name) {
                showError('Please enter a route name');
                return;
            }
            
            try {
                if (state.editingId) {
                    await api.updateRoute(state.editingId, { name, routeNumber, driverId });
                    showSuccess('Route updated successfully');
                } else {
                    await api.createRoute({ name, routeNumber, driverId });
                    showSuccess('Route created successfully');
                }
                closeModal('route');
                loadRoutes();
            } catch (error) {
                showError('Failed to save route: ' + error.message);
            }
        }
        
        async function saveProduct() {
            const form = document.getElementById('productForm');
            const formData = new FormData(form);
            
            const product = {
                name: formData.get('name').trim(),
                category: formData.get('category'),
                price: parseFloat(formData.get('price')),
                image: formData.get('image').trim() || null
            };
            
            if (!product.name || !product.category || isNaN(product.price)) {
                showError('Please fill in all required fields');
                return;
            }
            
            try {
                if (state.editingId) {
                    await api.updateProduct(state.editingId, product);
                    showSuccess('Product updated successfully');
                } else {
                    await api.createProduct(product);
                    showSuccess('Product created successfully');
                }
                closeModal('product');
                loadProducts();
            } catch (error) {
                showError('Failed to save product: ' + error.message);
            }
        }
        
        // Geocoding function
        async function geocodeAddress() {
            const addressInput = document.getElementById('locationAddress');
            const address = addressInput.value.trim();
            
            if (!address) {
                showError('Please enter an address before geocoding');
                return;
            }
            
            const statusDiv = document.getElementById('geocodeStatus');
            statusDiv.style.display = 'block';
            statusDiv.innerHTML = '<div class="status-info"><svg class="status-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" aria-hidden="true"><path d="M21 12a9 9 0 11-6.219-8.56"></path></svg> Geocoding address...</div>';
            
            try {
                // Call backend geocoding endpoint
                const response = await fetch(`${api.baseUrl}/geocode`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({ address })
                });
                
                if (!response.ok) {
                    throw new Error('Geocoding failed');
                }
                
                const data = await response.json();
                
                if (data.latitude && data.longitude) {
                    // Update coordinate fields
                    document.getElementById('locationLatitude').value = data.latitude;
                    document.getElementById('locationLongitude').value = data.longitude;
                    
                    // Show success message
                    statusDiv.innerHTML = '<div class="status-success"><svg class="status-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" aria-hidden="true"><polyline points="20,6 9,17 4,12"></polyline></svg> Address geocoded successfully!</div>';
                    
                    // Show map preview
                    showMapPreview(data.latitude, data.longitude);
                } else {
                    throw new Error('No coordinates returned');
                }
            } catch (error) {
                statusDiv.innerHTML = '<div class="status-error"><svg class="status-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" aria-hidden="true"><circle cx="12" cy="12" r="10"></circle><line x1="15" y1="9" x2="9" y2="15"></line><line x1="9" y1="9" x2="15" y2="15"></line></svg> Failed to geocode address. Please check the address and try again.</div>';
                console.error('Geocoding error:', error);
            }
        }
        
        // Show map preview
        function showMapPreview(lat, lng) {
            const mapDiv = document.getElementById('mapPreview');
            mapDiv.style.display = 'block';
            
            // Remove existing map if any
            if (locationMap) {
                locationMap.remove();
                locationMap = null;
                locationMarker = null;
            }
            
            // Create new map
            locationMap = L.map('mapPreview').setView([lat, lng], 15);
            
            // Add tile layer
            L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
                attribution: '© OpenStreetMap contributors',
                maxZoom: 19
            }).addTo(locationMap);
            
            // Add marker
            locationMarker = L.marker([lat, lng]).addTo(locationMap);
            
            // Fix map display issues
            setTimeout(() => {
                if (locationMap) {
                    locationMap.invalidateSize();
                }
            }, 100);
        }
        
        // Utility functions
        function formatDate(dateString) {
            if (!dateString) return '-';
            const date = new Date(dateString);
            return date.toLocaleDateString('en-US', { 
                year: 'numeric', 
                month: 'short', 
                day: 'numeric' 
            });
        }
        
        function escapeHtml(text) {
            const div = document.createElement('div');
            div.textContent = text;
            return div.innerHTML;
        }
        
        function showError(message) {
            alert('Error: ' + message);
        }
        
        function showSuccess(message) {
            alert(message);
        }
        
        // API extensions
        if (!api.getRoutes) {
            api.getRoutes = async function() {
                const response = await fetch(`${this.baseUrl}/routes`);
                if (!response.ok) {
                    throw new Error(`HTTP error! status: ${response.status}`);
                }
                return response.json();
            };
        }
        
        if (!api.createRoute) {
            api.createRoute = async function(route) {
                const response = await fetch(`${this.baseUrl}/routes`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify(route)
                });
                if (!response.ok) {
                    const error = await response.json();
                    throw new Error(error.error || `HTTP error! status: ${response.status}`);
                }
                return response.json();
            };
        }
        
        if (!api.updateRoute) {
            api.updateRoute = async function(id, route) {
                const response = await fetch(`${this.baseUrl}/routes/${id}`, {
                    method: 'PUT',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify(route)
                });
                if (!response.ok) {
                    const error = await response.json();
                    throw new Error(error.error || `HTTP error! status: ${response.status}`);
                }
                return response.json();
            };
        }
        
        if (!api.deleteRoute) {
            api.deleteRoute = async function(id) {
                const response = await fetch(`${this.baseUrl}/routes/${id}`, {
                    method: 'DELETE'
                });
                if (!response.ok) {
                    const error = await response.json();
                    throw new Error(error.error || `HTTP error! status: ${response.status}`);
                }
                return response.json();
            };
        }
        
        if (!api.getLocations) {
            api.getLocations = async function() {
                const response = await fetch(`${this.baseUrl}/locations`);
                if (!response.ok) {
                    throw new Error(`HTTP error! status: ${response.status}`);
                }
                return response.json();
            };
        }
        
        if (!api.createLocation) {
            api.createLocation = async function(location) {
                const response = await fetch(`${this.baseUrl}/locations`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify(location)
                });
                if (!response.ok) {
                    const error = await response.json();
                    throw new Error(error.error || `HTTP error! status: ${response.status}`);
                }
                return response.json();
            };
        }
        
        if (!api.updateLocation) {
            api.updateLocation = async function(id, location) {
                const response = await fetch(`${this.baseUrl}/locations/${id}`, {
                    method: 'PUT',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify(location)
                });
                if (!response.ok) {
                    const error = await response.json();
                    throw new Error(error.error || `HTTP error! status: ${response.status}`);
                }
                return response.json();
            };
        }
        
        if (!api.deleteLocation) {
            api.deleteLocation = async function(id) {
                const response = await fetch(`${this.baseUrl}/locations/${id}`, {
                    method: 'DELETE'
                });
                if (!response.ok) {
                    const error = await response.json();
                    throw new Error(error.error || `HTTP error! status: ${response.status}`);
                }
                return response.json();
            };
        }
        
        if (!api.getDrivers) {
            api.getDrivers = async function() {
                const response = await fetch(`${this.baseUrl}/drivers`);
                if (!response.ok) {
                    throw new Error(`HTTP error! status: ${response.status}`);
                }
                return response.json();
            };
        }
        
        if (!api.createProduct) {
            api.createProduct = async function(product) {
                const response = await fetch(`${this.baseUrl}/products`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify(product)
                });
                if (!response.ok) {
                    const error = await response.json();
                    throw new Error(error.error || `HTTP error! status: ${response.status}`);
                }
                return response.json();
            };
        }
        
        if (!api.updateProduct) {
            api.updateProduct = async function(id, product) {
                const response = await fetch(`${this.baseUrl}/products/${id}`, {
                    method: 'PUT',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify(product)
                });
                if (!response.ok) {
                    const error = await response.json();
                    throw new Error(error.error || `HTTP error! status: ${response.status}`);
                }
                return response.json();
            };
        }
        
        if (!api.deleteProduct) {
            api.deleteProduct = async function(id) {
                const response = await fetch(`${this.baseUrl}/products/${id}`, {
                    method: 'DELETE'
                });
                if (!response.ok) {
                    const error = await response.json();
                    throw new Error(error.error || `HTTP error! status: ${response.status}`);
                }
                return response.json();
            };
        }
        
        // Filter functionality with debouncing
        function setupFilterHandlers() {
            // Create debounced filter function
            const debouncedApplyFilters = debounce(applyFilters, 300);
            
            document.addEventListener('input', function(e) {
                if (e.target.classList.contains('filter-input')) {
                    const filterKey = e.target.dataset.filter;
                    const filterValue = e.target.value.toLowerCase();
                    
                    if (!state.activeFilters[state.currentTab]) {
                        state.activeFilters[state.currentTab] = {};
                    }
                    
                    state.activeFilters[state.currentTab][filterKey] = filterValue;
                    
                    // Use debounced version to improve performance
                    debouncedApplyFilters();
                    
                    // Announce filter change to screen readers
                    const rowCount = document.querySelectorAll(`#${state.currentTab}Table tbody tr:not([style*="display: none"])`).length;
                    e.target.setAttribute('aria-label', `Filter by ${filterKey}, ${rowCount} results shown`);
                }
            });
        }
        
        function applyFilters() {
            const currentFilters = state.activeFilters[state.currentTab] || {};
            let dataToFilter = [];
            
            switch(state.currentTab) {
                case 'locations':
                    dataToFilter = state.locations;
                    break;
                case 'routes':
                    dataToFilter = state.routes;
                    break;
                case 'products':
                    dataToFilter = state.products;
                    break;
            }
            
            if (!dataToFilter.length) return;
            
            const filteredData = dataToFilter.filter(item => {
                for (const [key, value] of Object.entries(currentFilters)) {
                    if (!value || value.trim() === '') continue;
                    
                    let itemValue = '';
                    switch(key) {
                        case 'name':
                            itemValue = item.name || '';
                            break;
                        case 'address':
                            itemValue = item.address || '';
                            break;
                        case 'category':
                            itemValue = item.category || '';
                            break;
                        case 'price':
                            itemValue = item.price ? `$${item.price.toFixed(2)}` : '';
                            break;
                        case 'route_number':
                            itemValue = item.route_number ? item.route_number.toString() : '';
                            break;
                        case 'driver_name':
                            itemValue = item.driver_name || '';
                            break;
                        case 'created_at':
                            itemValue = formatDate(item.created_at);
                            break;
                    }
                    
                    if (!itemValue.toLowerCase().includes(value.toLowerCase())) {
                        return false;
                    }
                }
                return true;
            });
            
            renderFilteredData(filteredData);
        }
        
        function renderFilteredData(data) {
            switch(state.currentTab) {
                case 'locations':
                    renderLocationsTable(data);
                    break;
                case 'routes':
                    renderRoutesTable(data);
                    break;
                case 'products':
                    renderProductsTable(data);
                    break;
            }
        }
        
        function renderLocationsTable(data) {
            const tbody = document.getElementById('locationsTableBody');
            const filterRow = `
                <tr class="filter-row">
                    <td><input type="text" class="filter-input" data-filter="name" placeholder="Filter by name..."></td>
                    <td><input type="text" class="filter-input" data-filter="address" placeholder="Filter by address..."></td>
                    <td></td>
                    <td></td>
                    <td><input type="text" class="filter-input" data-filter="created_at" placeholder="Filter by date..."></td>
                    <td></td>
                </tr>
            `;
            const dataRows = data.map(location => {
                const locationJson = JSON.stringify({
                    id: location.id,
                    name: location.name,
                    address: location.address,
                    latitude: location.latitude,
                    longitude: location.longitude
                }).replace(/"/g, '&quot;');
                
                return `
                    <tr>
                        <td><strong>${escapeHtml(location.name)}</strong></td>
                        <td>${escapeHtml(location.address || '-')}</td>
                        <td>${location.latitude || '-'}</td>
                        <td>${location.longitude || '-'}</td>
                        <td>${formatDate(location.created_at)}</td>
                        <td>
                            <div class="action-buttons">
                                <button class="btn btn-secondary btn-sm" onclick='editLocation(${locationJson})'>
                                    <svg class="btn-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" aria-hidden="true">
                                        <path d="M11 4H4a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7"></path>
                                        <path d="m18.5 2.5 a2.12 2.12 0 0 1 3 3l-8 8-4 1 1-4z"></path>
                                    </svg>
                                    Edit
                                </button>
                                <button class="btn btn-danger btn-sm" onclick="deleteLocation(${location.id}, '${escapeHtml(location.name).replace(/'/g, '\\\'')}')">                                 <svg class="btn-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" aria-hidden="true">
                                        <polyline points="3,6 5,6 21,6"></polyline>
                                        <path d="m19,6 v14a2,2 0 01-2,2H7a2,2 0 01-2,-2V6m3,0V4a2,2 0 012,-2h4a2,2 0 012,2v2"></path>
                                        <line x1="10" y1="11" x2="10" y2="17"></line>
                                        <line x1="14" y1="11" x2="14" y2="17"></line>
                                    </svg>
                                    Delete
                                </button>
                            </div>
                        </td>
                    </tr>
                `;
            }).join('');
            tbody.innerHTML = filterRow + dataRows;
        }
        
        function renderRoutesTable(data) {
            const tbody = document.getElementById('routesTableBody');
            const filterRow = `
                <tr class="filter-row">
                    <td><input type="text" class="filter-input" data-filter="name" placeholder="Filter by name..."></td>
                    <td><input type="text" class="filter-input" data-filter="route_number" placeholder="Filter by number..."></td>
                    <td><input type="text" class="filter-input" data-filter="driver_name" placeholder="Filter by driver..."></td>
                    <td><input type="text" class="filter-input" data-filter="created_at" placeholder="Filter by date..."></td>
                    <td></td>
                </tr>
            `;
            const dataRows = data.map(route => `
                <tr>
                    <td><strong>${escapeHtml(route.name)}</strong></td>
                    <td>${route.route_number || '-'}</td>
                    <td>${route.driver_name ? `<svg class="table-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" aria-hidden="true"><path d="M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2"></path><circle cx="12" cy="7" r="4"></circle></svg> ${escapeHtml(route.driver_name)}` : '<span style="color: #9ca3af;">Unassigned</span>'}</td>
                    <td>${formatDate(route.created_at)}</td>
                    <td>
                        <div class="action-buttons">
                            <button class="btn btn-secondary btn-sm" onclick="editRoute(${route.id}, '${escapeHtml(route.name).replace(/'/g, '\\\'')}', ${route.route_number || 'null'}, ${route.driver_id || 'null'})">
                                <svg class="btn-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" aria-hidden="true">
                                    <path d="M11 4H4a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7"></path>
                                    <path d="m18.5 2.5 a2.12 2.12 0 0 1 3 3l-8 8-4 1 1-4z"></path>
                                </svg>
                                Edit
                            </button>
                            <button class="btn btn-danger btn-sm" onclick="deleteRoute(${route.id}, '${escapeHtml(route.name).replace(/'/g, '\\\'')}')">                             <svg class="btn-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" aria-hidden="true">
                                    <polyline points="3,6 5,6 21,6"></polyline>
                                    <path d="m19,6 v14a2,2 0 01-2,2H7a2,2 0 01-2,-2V6m3,0V4a2,2 0 012,-2h4a2,2 0 012,2v2"></path>
                                    <line x1="10" y1="11" x2="10" y2="17"></line>
                                    <line x1="14" y1="11" x2="14" y2="17"></line>
                                </svg>
                                Delete
                            </button>
                        </div>
                    </td>
                </tr>
            `).join('');
            tbody.innerHTML = filterRow + dataRows;
        }
        
        function renderProductsTable(data) {
            const tbody = document.getElementById('productsTableBody');
            const filterRow = `
                <tr class="filter-row">
                    <td></td>
                    <td><input type="text" class="filter-input" data-filter="name" placeholder="Filter by name..."></td>
                    <td><input type="text" class="filter-input" data-filter="category" placeholder="Filter by category..."></td>
                    <td><input type="text" class="filter-input" data-filter="price" placeholder="Filter by price..."></td>
                    <td><input type="text" class="filter-input" data-filter="created_at" placeholder="Filter by date..."></td>
                    <td></td>
                </tr>
            `;
            const dataRows = data.map(product => `
                <tr>
                    <td>
                        ${product.image 
                            ? `<img src="${escapeHtml(product.image)}" alt="${escapeHtml(product.name)}" class="image-preview" onerror="this.style.display='none'; this.nextElementSibling.style.display='flex';">
                               <div class="image-placeholder" style="display:none;">No Image</div>`
                            : '<div class="image-placeholder">No Image</div>'}
                    </td>
                    <td><strong>${escapeHtml(product.name)}</strong></td>
                    <td><span style="background: #e2e8f0; padding: 0.25rem 0.5rem; border-radius: 0.25rem; font-size: 0.75rem; text-transform: uppercase;">${escapeHtml(product.category)}</span></td>
                    <td><strong style="color: #059669;">$${product.price.toFixed(2)}</strong></td>
                    <td>${formatDate(product.created_at)}</td>
                    <td>
                        <div class="action-buttons">
                            <button class="btn btn-secondary btn-sm" onclick="editProduct(${product.id}, '${escapeHtml(product.name).replace(/'/g, '\\\'')}, '${product.category}', ${product.price}, '${escapeHtml(product.image || '').replace(/'/g, '\\\'')}')">                                <svg class="btn-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" aria-hidden="true">
                                    <path d="M11 4H4a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7"></path>
                                    <path d="m18.5 2.5 a2.12 2.12 0 0 1 3 3l-8 8-4 1 1-4z"></path>
                                </svg>
                                Edit
                            </button>
                            <button class="btn btn-danger btn-sm" onclick="deleteProduct(${product.id}, '${escapeHtml(product.name).replace(/'/g, '\\\'')}')">                                <svg class="btn-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" aria-hidden="true">
                                    <polyline points="3,6 5,6 21,6"></polyline>
                                    <path d="m19,6 v14a2,2 0 01-2,2H7a2,2 0 01-2,-2V6m3,0V4a2,2 0 012,-2h4a2,2 0 012,2v2"></path>
                                    <line x1="10" y1="11" x2="10" y2="17"></line>
                                    <line x1="14" y1="11" x2="14" y2="17"></line>
                                </svg>
                                Delete
                            </button>
                        </div>
                    </td>
                </tr>
            `).join('');
            tbody.innerHTML = filterRow + dataRows;
        }
    </script>
</body>
</html>